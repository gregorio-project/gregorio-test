\documentclass[a5paper,11pt,DIV=17]{scrartcl}

\usepackage{fontspec}
\setmainfont[
    Path = ../../../../fonts/ ,
    Extension = .otf ,
    UprightFont = *-Regular ,
    UprightFeatures = { SmallCapsFont = *SC-Regular } ,
    BoldFont = *-Bold ,
    BoldFeatures = { SmallCapsFont = *SC-Bold } ,
    ItalicFont = *-Italic ,
    ItalicFeatures = { SmallCapsFont = *SC-Italic } ,
    BoldItalicFont = *-BoldItalic ,
    BoldItalicFeatures = { SmallCapsFont = *SC-BoldItalic } ,
    Ligatures = TeX
]{Alegreya}
\usepackage[autocompile,allowdeprecated=false,debug=all]{gregoriotex}
\usepackage{calc}
\pagestyle{empty}
\grechangestaffsize{13}
\newlength\tmpsize
\makeatletter
\setlength\tmpsize{\gre@factor pt}
\makeatother
\grechangestyle{initial}{\fontsize{2.5\tmpsize}{2.5\tmpsize}\selectfont}
\parindent=0pt

\listfiles
\begin{document}

First, let's show default behaviour :

\greannotation{\scriptsize Test}
\greannotation{\scriptsize 1.}
\gabcsnippet{(f3) Dó(f)mi(fgf___)ne.(f.,ef!hhkxi./jkI'Gh_ihhf.) (::)}

\smallskip
Here, one would expect second annotation to ``touch" the first :

\begingroup
\grechangedim{annotationseparation}{0em}{fixed}
\greannotation{\scriptsize Test}
\greannotation{\scriptsize T.}
\gabcsnippet{(f3) Dó(f)mi(fgf___)ne.(f.,ef!hhkxi./jkI'Gh_ihhf.) (::)}
\endgroup

\smallskip
So, let's try a negative value : one would expect the first not to move, but the second to raise.

\begingroup
\grechangedim{annotationseparation}{-2mm}{fixed}
\greannotation{\scriptsize Test}
\greannotation{\scriptsize 1.}
\gabcsnippet{(f3) Dó(f)mi(fgf___)ne.(f.,ef!hhkxi./jkI'Gh_ihhf.) (::)}
\endgroup

\smallskip
With a positive value, the second annotation is lower.

\begingroup
\grechangedim{annotationseparation}{3mm}{fixed}
\greannotation{\scriptsize Test}
\greannotation{\scriptsize 1.}
\gabcsnippet{(f3) Dó(f)mi(fgf___)ne.(f.,ef!hhkxi./jkI'Gh_ihhf.) (::)}
\endgroup

\smallskip
Checking alignment controls:

Top of topline:
\gresetannotationvalign{top}
\greannotation{\scriptsize Testy}
\greannotation{\scriptsize Testy}
\gabcsnippet{(f3) Dó(f)mi(fgf___)ne.(f.,ef!hhkxi./jkI'Gh_ihhf.) (::)}

Baseline of topline (default):
\gresetannotationvalign{baseline}
\greannotation{\scriptsize Testy}
\greannotation{\scriptsize Testy}
\gabcsnippet{(f3) Dó(f)mi(fgf___)ne.(f.,ef!hhkxi./jkI'Gh_ihhf.) (::)}

Bottom of topline:
\gresetannotationvalign{bottom}
\greannotation{\scriptsize Testy}
\greannotation{\scriptsize Testy}
\gabcsnippet{(f3) Dó(f)mi(fgf___)ne.(f.,ef!hhkxi./jkI'Gh_ihhf.) (::)}

Top of bottomline:
\gresetannotationby{bottomline}
\gresetannotationvalign{top}
\greannotation{\scriptsize Testy}
\greannotation{\scriptsize Testy}
\gabcsnippet{(f3) Dó(f)mi(fgf___)ne.(f.,ef!hhkxi./jkI'Gh_ihhf.) (::)}

Baseline of bottomline:
\gresetannotationvalign{baseline}
\greannotation{\scriptsize Testy}
\greannotation{\scriptsize Ty}
\gabcsnippet{(f3) Dó(f)mi(fgf___)ne.(f.,ef!hhkxi./jkI'Gh_ihhf.) (::)}

Bottom of bottomline:
\gresetannotationvalign{bottom}
\greannotation{\scriptsize Testy}
\greannotation{\scriptsize Testy}
\gabcsnippet{(f3) Dó(f)mi(fgf___)ne.(f.,ef!hhkxi./jkI'Gh_ihhf.) (::)}


Bottom of bottomline with 3 lines:
\gresetannotationvalign{bottom}
\greannotation{\scriptsize Testy}
\greannotation{\scriptsize Testy}
\greannotation{\scriptsize Testy}
\gabcsnippet{(f3) Dó(f)mi(fgf___)ne.(f.,ef!hhkxi./jkI'Gh_ihhf.) (::)}

\end{document}
